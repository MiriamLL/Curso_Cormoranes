---
title: "Cormoranes"
subtitle: "Grupo 6"
author: "Alonso Huyhua, Carolina Meza y Miriam Lerma"
date: "01-Febrero-2021"
output:
  xaringan::moon_reader:
    css: ["default","chocolate-fonts"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
---
class: center, middle

### Distancias de la colonia y profundidad de buceo del guanay ***(Phalacrocorax bougainvillii)***, antes y durante la temporada de pesca.

```{r echo=FALSE, out.height=200, out.width= 200}
knitr::include_graphics("https://cdn.download.ams.birds.cornell.edu/api/v1/asset/107157281/1800")
```

---

class: center, middle

## 1. Antecedentes

Los guanay ***(Phalacrocorax bougainvillii)*** se alimentan principalmente de anchoveta ***(Engraulis rigens)***

```{r echo=FALSE, out.height=100, out.width= 200}
knitr::include_graphics("https://tumi.lamolina.edu.pe/infopes/wp-content/uploads/2018/06/anchoveta.jpg")
```

En Perú, la temporada de pesca coincide con la temporada de reproducción de los guanays.

---

class: center, middle

## 2. Justificación


- Conocer si hay diferencias entre sexos en las áreas y profundidades que utilizan para alimentarse nos ayuda a mejorar medidas de protección de la especie.
- Así como tener información de que sexo puede ser más vulnerable a la temporada de pesca.

`r emo::ji("fish")`

---

## 3. Objetivos

Evaluar:   
- Si las hembras bucean más profundo o viajan más lejos que los machos.  

--

- Si los guanay bucean más profundo o viajan más lejos en Julio (cuando está abierta la pesca) comparado con Abril (antes de que se abra la temporada).

---

class: center

## 4. Metodología

Se tomaron muestras de hembras y machos de guanay (n=20), antes (Abril) y durante (Julio) la temporada de pesca de anchoveta.


Los datos se tomaron en la Isla Lobos de Afuera en Perú.

```{r Paquetes2, warning=FALSE, message=FALSE, eval= TRUE, echo=FALSE}
#Paquetes
library(emo)
library(ggplot2)
library(dplyr)
library(tidyr)
library(rnaturalearth)
library(rnaturalearthdata)
world <- ne_countries(scale = "medium", returnclass = "sf")
```

```{r Colonia, eval= FALSE, echo=FALSE}
#Extraer cordenadas de la colonia
MiColonia <- Tracks %>% 
  summarise(Longitude = first(Longitude),Latitude  = first(Latitude), )
```

```{r Area de estudio, warning=FALSE, eval= FALSE, echo=FALSE}
#Graficar area de estudio
PlotAreadeEstudio<-ggplot()+
    geom_sf(data = world) +
    coord_sf(xlim = c(-85, -65), ylim = c(-30, 0), expand = FALSE)+
    geom_point(data = MiColonia, aes(x = Longitude, y = Latitude), 
               color = "black",fill="white",
               size = 5,shape=21,stroke = 3)+
  geom_text(aes(x=-75,y=-10),label = "PERU", size=5)+  theme_bw()
```

```{r echo=FALSE, out.height=400, out.width= 250}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/PlotAreadeEstudio.jpg")
```

---

class: center, middle

## 4. Metodología

--

## Un poco de R


---

## 4. Metodología
### 4.1.1. Importar excels

Con que tengan una carpeta con los excels del curso.

Usando estos paquetes:
```{r Paquetes Datos, warning=FALSE, message=FALSE, eval=TRUE, echo=TRUE}
library(here)
library(readxl)
```

Siguiendo este código:
```{r Unir excels, eval=TRUE, echo=TRUE}
MainFolder<-here()
DataFolder<-paste0(MainFolder,'//0Excels')
files_Cormorant <- list.files(DataFolder,
                              pattern="*.xlsx", 
                              full.names=TRUE)
List_Cormoranes <- lapply(files_Cormorant, 
                          read_excel)
TracksCormoranes <- do.call("rbind", 
                            List_Cormoranes)
```

---

## 4. Metodología
### 4.1.2. Unir excels

Quitamos los NA's
```{r Nas, include=TRUE, eval=TRUE, echo=TRUE}
TracksCormoranes <- TracksCormoranes[complete.cases(TracksCormoranes$Latitude),]
```

Renombrar para más rápido
```{r Renombrar, eval= TRUE, echo=TRUE}
Tracks<-TracksCormoranes
```

Queda así
```{r Tabla Tracks,comment="", eval= TRUE, echo=TRUE}
str(Tracks)
```

---

## 4. Metodología
### 4.2.1. Parametros del viaje
Máximos de buceo 
```{r Convertir buceos, echo=TRUE, eval= TRUE}
Tracks$Depth<-as.numeric(Tracks$Depth) 
```

Calcular los máximos de buceo de cada individuo
```{r ProfundidadBuceos, echo=TRUE, eval= TRUE}
ProfundidadBuceos<-Tracks %>%
  group_by(TagID) %>%
   summarise_at(c("Depth"), max, na.rm = TRUE) 
```

Queda así
```{r ProfundidadBuceoTabla, echo=TRUE, eval= TRUE}
head(ProfundidadBuceos,8)
```


---

## 4. Metodología
### 4.2.2. Parametros del viaje
Distancias máximas

Paquetes
```{r Paquetes espaciales, echo=TRUE, eval= TRUE, warning=FALSE, message=FALSE}
library(geosphere) #distm
library(rgeos) #coordinates
```

Transformamos a datos espaciales
- Los tracks:
```{r TracksSp, echo=TRUE, eval= TRUE}
TracksSp<-Tracks
TracksSp$lat<-TracksSp$Latitude
TracksSp$lon<-TracksSp$Longitude
coordinates(TracksSp)<-~lon+lat
```

- La colonia:
```{r Colonia2, eval= TRUE, echo=FALSE}
MiColonia <- Tracks %>% 
  summarise(Longitude = first(Longitude),Latitude  = first(Latitude), )
```

```{r ColoniaSp, echo=TRUE, eval= TRUE}
LaColonia<- SpatialPoints(cbind(MiColonia$Longitude,MiColonia$Latitude)) 
```

---

## 4. Metodología
### 4.2.2. Parametros del viaje
Distancias máximas

Calculamos distancia en metros y transformamos a kilometros
```{r Metros, echo=TRUE, eval= TRUE, warning=FALSE}
Metros<-(distm(TracksSp,MiColonia,fun = distHaversine))
TracksDist<-cbind(Tracks,Metros)
TracksDist$Km<-TracksDist$Metros/1000
```

```{r Tabla, echo=TRUE, eval= TRUE}
head(TracksDist)
```

---

## 4. Metodología
### 4.2.2. Parametros del viaje
Distancias máximas

Calcular la distancia maxima de cada individuo
```{r DistanciaColonia, echo=TRUE, eval= TRUE}
DistanciaColonia<-TracksDist %>%
  group_by(TagID) %>%
   summarise_at(c("Km"), max, na.rm = TRUE) 
```

Queda así
```{r DistanciaColonia2,echo=TRUE, eval= TRUE}
head(DistanciaColonia,8)
```

---

## 4. Metodología
### 4.3.1. Crear tabla

Importar datos de medidas
```{r Medidas, echo=TRUE, eval= TRUE, warning=FALSE}
Medidas<-read_excel(here("./1Datos/Data_cormorantX.xlsx"))
colnames(Medidas)[1]<-'TagID'
```

Unir medidas con distancias máximas y profundidades de buceo
```{r Unir tablas, echo=TRUE, eval= TRUE}
TablaDistancias<-left_join(Medidas,DistanciaColonia,by='TagID')
TablaCompleta<-left_join(TablaDistancias,ProfundidadBuceos,by='TagID')
```

Tabla completa
```{r Ver tabla, echo=TRUE, eval= TRUE, include=TRUE}
head(TablaCompleta)
```


---

## 4. Metodología
### 4.4.1. Promedios 
Máximos de buceo

```{r Tabla Completa, echo=TRUE, eval= TRUE, include=TRUE, message=FALSE, warning=FALSE}
TablaCompleta %>%
  group_by(Sex,Month) %>%
  summarise_at(c("Depth"), funs(mean, sd), na.rm = TRUE) 
```

---

## 4. Metodología
### 4.4.1. Promedios 
Máximos de buceo

Código para figura
```{r PlotBuceos, include=TRUE, warning=FALSE, eval= TRUE, echo=TRUE}
PlotBuceos<-ggplot(TablaCompleta, aes(x=Month, y=Depth,fill=Sex))+
  xlab("Temporada de pesca")+ylab("Profundidad de buceo maxima \n (m)")+
  geom_boxplot()+
    scale_fill_manual(values=c("#f4a261","#2a9d8f","#f4a261","#2a9d8f")) +
  theme_classic()+
  theme(axis.text.x =  element_text(size=12),
        axis.title.x = element_text(size=12),
        axis.text.y =  element_text(size=12),
        axis.title.y = element_text(size=12),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")
```

---

## 4. Metodología
### 4.4.1. Promedios 
Máximos de buceo

Figura preliminar
```{r, warning=FALSE, eval=FALSE, include=FALSE, echo=FALSE}
#ResultsFolder<-here::here("3Results")
#PlotBuceos
#ggsave("PlotBuceos.jpg",path = ResultsFolder,width = 8, height = 5, units = "in")
```

```{r echo=FALSE, out.height=300, out.width= 500}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/PlotBuceos.jpg")
```

---

## 4. Metodología
### 4.4.2. Promedios 
Distancias máximas

```{r PromedioBuceosTabla, echo=TRUE, eval= TRUE, include=TRUE, message=FALSE, warning=FALSE, comment=''}
TablaCompleta %>%
  group_by(Sex,Month) %>%
  summarise_at(c("Km"), funs(mean, sd), na.rm = TRUE) 
```

---

## 4. Metodología
### 4.4.2. Promedios 
Distancias máximas

Código figura
```{r PlotDistanciasKm, echo=TRUE, eval= TRUE, include=TRUE,message=FALSE, warning=FALSE}
PlotDistancias<-ggplot(TablaCompleta, aes(x=Month, y=Km,fill=Sex))+
  geom_boxplot()+
  xlab("Temporada de pesca")+ylab("Distancia de la colonia \n (m)")+
  geom_boxplot()+
    scale_fill_manual(values=c("#f4a261","#2a9d8f","#f4a261","#2a9d8f")) +
  theme_classic()+
  theme(axis.text.x =  element_text(size=12),
        axis.title.x = element_text(size=12),
        axis.text.y =  element_text(size=12),
        axis.title.y = element_text(size=12),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")
```

---

## 4. Metodología
### 4.4.2. Promedios 
Distancias máximas

Figura preliminar: distancias
```{r,message=FALSE, warning=FALSE, include=FALSE,eval=FALSE, echo=FALSE}
#ResultsFolder<-here::here("3Results")
#PlotDistancias
#ggsave("PlotDistancias.jpg",path = ResultsFolder,width = 8, height = 5, units = "in")
```

```{r echo=FALSE, out.height=300, out.width=500}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/PlotDistancias.jpg")
```

---

## 4. Metodología
### 4.4.2. Promedios 
Distancias máximas

Función para crear mapas
```{r plots por individiduos}
Ploteame<-function(Datos=Datos){
  MiPlot<-ggplot()+
    geom_sf(data = world) +
    coord_sf(xlim = c(-81, -80), ylim = c(-7.5, -6.5), expand = FALSE)+
    geom_path(data = Datos, aes(x = Longitude, y = Latitude, color=TagID), size=1)+
  theme_bw()+
    theme(panel.border = element_rect(linetype = "solid", colour = "black", size=1.5),
        axis.title = element_text(size=8),axis.ticks.length = unit(3, "pt"),
        axis.text.x =  element_text(size=8),axis.text.y =  element_text(size=8),
        panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
        legend.title = element_text(size=8),legend.text = element_text(size=8),
        panel.background = element_rect(fill = "white"),legend.justification=c(0,0), 
        plot.title = element_text(size = 15, face = "bold"),
        legend.position='top') + 
   labs(x = "Longitude", y="Latitude")+
   geom_point(data = MiColonia, mapping = aes(x = Longitude, y = Latitude), 
             color = "black", fill="white", size = 10,shape=21,stroke = 3)
  return(MiPlot)
}
```

---

## 4. Metodología
### 4.4.2. Promedios 
Crear un mapa por sexo y mes

Agregar medidas a Tracks
```{r unir tablas por id}
TracksC<-left_join(Tracks,Medidas,by='TagID')
```

Creamos mapas por sexo y etapa (usando la funcion de 'Ploteame') 
```{r FA, eval=TRUE}
FA<-subset(TracksC,TracksC$Sex=='F' & TracksC$Month=='Apr')
MapaA<-Ploteame(Datos=FA)+
  ggtitle('Hembras Abril')
```

```{r FD, eval=TRUE}
FD<-subset(TracksC,TracksC$Sex=='F' & TracksC$Month=='Jul')
MapaB<-Ploteame(Datos=FD)+
  ggtitle('Hembras Julio')
```

```{r MA, eval=TRUE}
MA<-subset(TracksC,TracksC$Sex=='M' & TracksC$Month=='Apr')
MapaC<-Ploteame(Datos=MA)+
  ggtitle('Machos Abril')
```

```{r MD, eval=TRUE}
MD<-subset(TracksC,TracksC$Sex=='M' & TracksC$Month=='Jul')
MapaD<-Ploteame(Datos=MD)+
  ggtitle('Machos Julio')
```

---

## 4. Metodología
### 4.4.2. Promedios 

Paquete
```{r cowplot, warning=FALSE, echo=TRUE}
library(cowplot)
```

Unir plot
```{r sexovedaplot, eval=TRUE, echo=TRUE}
MapasSexoVeda<-plot_grid(MapaA,MapaB,
                         MapaC,MapaD,ncol = 2, nrow=2)
```

```{r, eval=FALSE,include=FALSE, echo=TRUE}
#ResultsFolder<-here::here("3Results")
#MapasSexoVeda
#ggsave("MapasSexoVeda.jpg",path = ResultsFolder,width = 8, height = 8, units = "in")
```

---

## 4. Metodología
### 4.4.2. Promedios 

Tracks por individuos  

```{r echo=FALSE, out.height=400, out.width= 500}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/MapasSexoVeda.jpg")
```


---

## 4. Metodología
### 4.5.1. Estadisticos

- De acuerdo a nuestros objetivos lo mejor es usar una ANOVA de dos vías. 
- Para evaluar el efecto de dos factores (Sexo y Temporada de pesca) en una variable de respuesta (maximo de buceos y distancia maxima de los viajes, respectivamente). 





Nota: ***Son solo máximos, no hicimos correccion de ceros ni calculamos parametros por viaje por individuo***

---

## 4. Metodología
### 4.5.1. Estadisticos

Máximos de buceo

Modelo
```{r interacciones depth, comment=''}
ModeloBuceos<-aov(Depth~Sex+Month+Sex:Month, data=TablaCompleta)
summary(ModeloBuceos)
```

--

La **temporada de pesca** es significativo, independientemente del **sexo**.

---

## 4. Metodología
### 4.5.1. Estadisticos

Se cumplen los supuestos

```{r,warning=FALSE, include=FALSE, echo=TRUE}
library(car) #leveneTest
```

- Homogeneidad de las varianzas
```{r homogeneidad, comment='', echo=TRUE}
leveneTest(Depth~Sex:Month, data=TablaCompleta)
```

- Normalidad de los residuales
```{r normalidad, comment='', echo=TRUE}
aov_residuals <- residuals(object = ModeloBuceos)
shapiro.test(x = aov_residuals )
```

```{r normalidad2, echo=FALSE}
#plot(Mis_interacciones,1)
#plot(Mis_interacciones,2)
```

---

## 4. Metodología
### 4.5.1. Estadisticos
Distancias máximas

Para las distancias lo transformamos a escala logaritmica para mejorar la normalidad de los residuales. 
```{r anova km, comment='', echo=TRUE}
modeloKm<-aov(formula=log(Km)~Sex*Month,data=TablaCompleta)
summary(modeloKm)
```

--

La **temporada de pesca** es significativo y **sexo** tambien, pero no hay interacción entre ambos.


---

## 4. Metodologia
### 4.5.1. Estadisticos

Se cumplen los supuestos

- Homogeneidad de las varianzas
```{r, comment=''}
leveneTest(log(Km)~Sex:Month, data=TablaCompleta)
```

- Normalidad de los residuales
```{r normalidad km, comment=''}
aov_residuals <- residuals(object = modeloKm)
shapiro.test(x = aov_residuals)
```

---

---

## 5. Discusión
### 5.1. Máximos de buceo

Estos analisis preliminares sugieren que **no** hay diferencias significativas entre hembras y machos en las profundidades de buceo pero **si hay diferencias** entre antes y durante la temporada de pesca.   

Ambos sexos bucean **mas profundo** durante la temporada de pesca.  


```{r echo=FALSE, out.height=300, out.width= 400}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/PlotBuceos.jpg")
```

---

## 5. Discusión
### 5.1. Máximos de buceo

Lo cual apuntaria a:  
a) Cambio en la dieta.  
b) Cambio en las condiciones ambientales, que obliga a los cormoranes a bucear mas profundo.   
c) Un efecto de la temporada de pesca, tal vez un decremento en la disponibilidad de alimento cuando entran en competencia con las pesquerias, que obliga a los cormoranes a bucear mas profundo.  

---


## 5. Discusión
### 5.1. Distancias máximas

Estos analisis preliminares sugieren que **si** hay diferencias significativas en lasdistancias maximas que viajan entre hembras y machos, y entre durante y despues de la veda.  

Los machos viajan **mas lejos** que las hembras, y ambos viajan mas lejos en julio.

```{r echo=FALSE, out.height=300, out.width= 400}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/MapasSexoVeda.jpg")
```

---

## 5. Discusión
### 5.1. Distancias máximas

Lo cual sugiere que hay:  
Un efecto del sexo, donde los machos viajan en general mas lejos que las hembras, por que consumen diferentes presas, por competencia entre sexos, o por diferentes roles durante la reproduccion.  

a) Cambio en la dieta, por especies que se encuentran mas lejos de la colonia.  
b) Cambio en las condiciones ambientales que afecten la disponibilidad de presas entre abril y julio, que obliga a los cormoranes a viajar mas lejos.  
c) Un efecto de la temporada de pesca, tal vez un decremento en la disponibilidad de alimento que obliga a los cormoranes a viajar mas lejos.


---

## 5. Discusión
### 5.2. Antes de la temporada de pesca

Datos de Global Fishing Watch para el area general donde se encuentra la colonia para el mes de **abril** (antes de la temporada de pesca)

```{r, echo=FALSE, out.height=250, out.width= 500}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/GFW1.jpeg')
```

Coincide en el tiempo en que los buceos son **menos** profundos, y los viajes de los cormoranes **más cortos**.

---

## 5. Discusión
### 5.2. Durante de la temporada de pesca

Datos de Global Fishing Watch para el area general donde se encuentra la colonia para el mes de **julio** (durante de la temporada de pesca)

```{r, echo=FALSE, out.height=250, out.width= 500}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_Cormoranes/main/GFW2.jpeg')
```

Coincide en el tiempo en que los buceos son **más profundos**, y los viajes de los cormoranes **más largos**.

--

Es claro que el esfuerzo de pesca es mayor en Julio, y por lo tanto una razon potencial que puede explicar el cambio en el comportamiento de los cormoranes. 

---

# 6. Conclusiones

Encontramos que:


- No existen diferencias entre hembras y machos en las profundidades maximas del buceo, pero ambos sexos bucean mas profundo durante la temporada de pesca.

--

- Hay diferencias las distancias de la colonia, los machos viajan mas lejos que las hembras antes y durante la temporada de pesca y ambos sexos viajan mayores distancias durante la temporada de pesca. 


---

# 6. Conclusiones

- Esto sugiere que los sexos se alimentan en diferentes areas, pero a profundidades similares, pero que en julio los recursos estan menos disponibles y por lo tanto los cormoranes viajan mas lejos. 

--

- Aunque este es un estudio preliminar, conocer si hay diferencias entre sexos en las areas y profundidades que utilizan para alimentarse nos ayuda a mejorar medidas de proteccion de la especie.

--

- Por ahora la pesca parece afectar el comportamiento de los cormoranes ya sea por competencia directa o por que reducen la disponibilidad de presas.

- En algunas especies esto puede afectar su exito reproductivo, pero esto queda para estudios futuros.

---

class: center, middle

## Todo el material en

https://github.com/MiriamLL/Curso_Cormoranes

## Gracias 

```{r echo=FALSE, out.height=200, out.width= 300}
knitr::include_graphics("https://scontent.fham2-1.fna.fbcdn.net/v/t1.0-9/125369794_1017592122068396_8216067479374620034_o.png?_nc_cat=107&ccb=2&_nc_sid=09cbfe&_nc_ohc=Zs_v8fI_zW8AX-BDdkX&_nc_ht=scontent.fham2-1.fna&oh=a34c8fc4c28cc3d838702576ed65b1a0&oe=6033C883")
```
!


`r emo::ji("smile")`

